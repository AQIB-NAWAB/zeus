{"version":3,"names":["_reactNative","require","_lncCore","_createRpc","_credentialStore","_interopRequireDefault","_log","obj","__esModule","default","_defineProperty","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","t","i","_toPrimitive","String","r","e","Symbol","toPrimitive","call","TypeError","Number","DEFAULT_CONFIG","namespace","serverHost","LNC","constructor","lncConfig","keyHex","log","debug","credentials","localKey","remoteKey","config","assign","_namespace","credentialStore","LncCredentialStore","pairingPhrase","isPaired","lnd","LndApi","createRpc","loop","LoopApi","pool","PoolApi","faraday","FaradayApi","lit","LitApi","NativeModules","LncModule","initLNC","isConnected","status","expiry","Date","isReadOnly","hasPerms","permission","connect","connected","registerLocalPrivCreateCallback","onLocalPrivCreate","registerRemoteKeyReceiveCallback","onRemoteKeyReceive","registerAuthDataCallback","onAuthData","error","connectServer","disconnect","request","method","Promise","resolve","reject","reqJSON","JSON","stringify","invokeRPC","response","rawRes","parse","res","snakeKeysToCamel","Error","subscribe","initListener","exports"],"sources":["lnc.ts"],"sourcesContent":["import { NativeModules } from 'react-native';\nimport {\n    FaradayApi,\n    LitApi,\n    LndApi,\n    LoopApi,\n    PoolApi,\n    snakeKeysToCamel\n} from '@lightninglabs/lnc-core';\nimport { createRpc } from './api/createRpc';\nimport { CredentialStore, LncConfig } from './types/lnc';\nimport LncCredentialStore from './util/credentialStore';\nimport { log } from './util/log';\n\n/** The default values for the LncConfig options */\nconst DEFAULT_CONFIG = {\n    namespace: 'default',\n    serverHost: 'mailbox.terminal.lightning.today:443'\n} as Required<LncConfig>;\n\nexport default class LNC {\n    _namespace: string;\n    credentials: CredentialStore;\n\n    lnd: LndApi;\n    loop: LoopApi;\n    pool: PoolApi;\n    faraday: FaradayApi;\n    lit: LitApi;\n\n    constructor(lncConfig?: LncConfig) {\n        // merge the passed in config with the defaults\n        const config = Object.assign({}, DEFAULT_CONFIG, lncConfig);\n\n        this._namespace = config.namespace;\n\n        if (config.credentialStore) {\n            this.credentials = config.credentialStore;\n        } else {\n            this.credentials = new LncCredentialStore(config.pairingPhrase);\n            // don't overwrite an existing serverHost if we're already paired\n            if (!this.credentials.isPaired)\n                this.credentials.serverHost = config.serverHost;\n            if (config.pairingPhrase)\n                this.credentials.pairingPhrase = config.pairingPhrase;\n        }\n\n        this.lnd = new LndApi(createRpc, this);\n        this.loop = new LoopApi(createRpc, this);\n        this.pool = new PoolApi(createRpc, this);\n        this.faraday = new FaradayApi(createRpc, this);\n        this.lit = new LitApi(createRpc, this);\n        NativeModules.LncModule.initLNC(this._namespace);\n    }\n\n    onLocalPrivCreate = (keyHex: string) => {\n        log.debug('local private key created: ' + keyHex);\n        this.credentials.localKey = keyHex;\n    };\n\n    onRemoteKeyReceive = (keyHex: string) => {\n        log.debug('remote key received: ' + keyHex);\n        this.credentials.remoteKey = keyHex;\n    };\n\n    onAuthData = (keyHex: string) => {\n        log.debug('auth data received: ' + keyHex);\n    };\n\n    async isConnected() {\n        return await NativeModules.LncModule.isConnected(this._namespace);\n    }\n\n    async status() {\n        return await NativeModules.LncModule.status(this._namespace);\n    }\n\n    async expiry() {\n        const expiry = await NativeModules.LncModule.expiry(this._namespace);\n        return new Date(expiry * 1000);\n    }\n\n    async isReadOnly() {\n        return await NativeModules.LncModule.isReadOnly(this._namespace);\n    }\n\n    async hasPerms(permission: string) {\n        return await NativeModules.LncModule.hasPerms(\n            this._namespace,\n            permission\n        );\n    }\n\n    /**\n     * Connects to the LNC proxy server\n     * @returns a promise that resolves when the connection is established\n     */\n    async connect() {\n        // do not attempt to connect multiple times\n        const connected = await this.isConnected();\n        if (connected) return;\n\n        NativeModules.LncModule.registerLocalPrivCreateCallback(\n            this._namespace,\n            this.onLocalPrivCreate\n        );\n        NativeModules.LncModule.registerRemoteKeyReceiveCallback(\n            this._namespace,\n            this.onRemoteKeyReceive\n        );\n        NativeModules.LncModule.registerAuthDataCallback(\n            this._namespace,\n            this.onAuthData\n        );\n\n        const { pairingPhrase, localKey, remoteKey, serverHost } =\n            this.credentials;\n\n        // connect to the server\n        const error = await NativeModules.LncModule.connectServer(\n            this._namespace,\n            serverHost,\n            false,\n            pairingPhrase,\n            localKey,\n            remoteKey\n        );\n\n        return error;\n    }\n\n    /**\n     * Disconnects from the proxy server\n     */\n    disconnect() {\n        NativeModules.LncModule.disconnect(this._namespace);\n    }\n\n    /**\n     * Emulates a GRPC request but uses the mobile client instead to communicate with the LND node\n     * @param method the GRPC method to call on the service\n     * @param request The GRPC request message to send\n     */\n    request<TRes>(method: string, request?: object): Promise<TRes> {\n        return new Promise((resolve, reject) => {\n            log.debug(`${method} request`, request);\n            const reqJSON = JSON.stringify(request || {});\n            NativeModules.LncModule.invokeRPC(\n                this._namespace,\n                method,\n                reqJSON,\n                (response: string) => {\n                    try {\n                        const rawRes = JSON.parse(response);\n                        const res = snakeKeysToCamel(rawRes);\n                        log.debug(`${method} response`, res);\n                        resolve(res as TRes);\n                    } catch (error) {\n                        log.debug(`${method} raw response`, response);\n                        reject(new Error(response));\n                        return;\n                    }\n                }\n            );\n        });\n    }\n\n    /**\n     * Subscribes to a GRPC server-streaming endpoint and executes the `onMessage` handler\n     * when a new message is received from the server\n     * @param method the GRPC method to call on the service\n     * @param request the GRPC request message to send\n     * @param onMessage the callback function to execute when a new message is received\n     * @param onError the callback function to execute when an error is received\n     */\n    subscribe(method: string, request?: object): string {\n        log.debug(`${method} request`, request);\n        const reqJSON = JSON.stringify(request || {});\n        NativeModules.LncModule.initListener(this._namespace, method, reqJSON);\n        return method;\n    }\n}\n"],"mappings":"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"}